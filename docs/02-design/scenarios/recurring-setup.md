# 利用シナリオ - 繰り返しタスク設定

**作成日**: 2025-06-18  
**最終更新**: 2025-06-18  
**関連機能**: REPEAT-001  

---

## 🎯 シナリオ概要

繰り返しタスクの作成から日常的な利用まで、ユーザーの一連の操作フローを定義します。

---

## 👤 ペルソナ

**田中さん（プロジェクトマネージャー）**
- 毎朝9時に「日報作成」タスクが必要
- 毎週金曜日に「週次レポート」の提出
- 毎月1日に「月次振り返り」を実施
- タスクの取りこぼしを防ぎたい

---

## 📅 シナリオ 1: 毎日の繰り返しタスク作成（日報作成）

### 前提条件
- 田中さんがタスク管理画面（`/tasks`）にいる
- まだ繰り返しタスクは1つも作成していない
- 現在日時: 2025-06-18 (水) 14:00

### ステップ

#### 1. 繰り返しタスク作成画面への移動
- タスク管理画面で「繰り返しタスクを作成」ボタンをクリック
- `/recurring-tasks/new` 画面に遷移

#### 2. 基本情報の入力
- **タスク名**: 「日報作成」と入力
- **説明**: 「その日の業務内容と明日の予定を記録」と入力
- **優先度**: 「高」を選択

#### 3. 繰り返し設定
- **繰り返しパターン**: 「毎日」をクリック
- **詳細設定**をクリックして展開
- **実行日**: 「平日のみ（月-金）」を選択
- **除外日**: 「祝日をスキップ」にチェック

#### 4. 期間設定
- **開始日**: 「2025-06-19」（明日）を選択
- **終了日**: 「無期限」のまま（チェック済み）

#### 5. プレビュー確認
- 「プレビュー」ボタンをクリック
- 今後2週間分の生成予定が表示される
  ```
  📋 2025-06-19 (木) - 日報作成
  📋 2025-06-20 (金) - 日報作成
  📋 2025-06-23 (月) - 日報作成
  📋 2025-06-24 (火) - 日報作成
  ...
  ```

#### 6. 保存
- 内容を確認して「保存」ボタンをクリック
- 「繰り返しタスクが正常に作成されました」のメッセージ表示
- 繰り返しタスク一覧画面に遷移

### 期待結果
- [x] 繰り返しタスクがDBに正しく保存される
- [x] プレビューで正確な日付が表示される
- [x] 平日のみの設定が正しく反映される
- [x] UIが直感的で操作しやすい

---

## 📅 シナリオ 2: 毎週の繰り返しタスク作成（週次レポート）

### 前提条件
- 田中さんが繰り返しタスク一覧画面にいる
- 既に「日報作成」の繰り返しタスクが存在

### ステップ

#### 1. 新規作成
- 「新規作成」ボタンをクリック

#### 2. 基本情報入力
- **タスク名**: 「週次レポート作成」
- **説明**: 「今週の成果と来週の計画をまとめる」
- **優先度**: 「中」

#### 3. 毎週設定
- **繰り返しパターン**: 「毎週」を選択
- **詳細設定**:
  - **曜日**: 「金曜日」にチェック
  - **繰り返し間隔**: 「1週間おき」（デフォルト）

#### 4. 期間設定
- **開始日**: 「2025-06-20」（今週の金曜日）
- **終了日**: 「2025-12-31」を指定

#### 5. 保存と確認
- 「保存」をクリック
- 週次レポートが一覧に追加される

### 期待結果
- [x] 毎週金曜日に正確にタスクが生成される
- [x] 複数の繰り返しタスクが共存できる
- [x] 終了日の設定が正しく機能する

---

## 🌅 シナリオ 3: 日常利用 - ページアクセス時の自動タスク生成

### 前提条件
- 「日報作成」と「週次レポート」の繰り返しタスクが設定済み
- 現在日時: 2025-06-19 (木) 09:00（翌日の朝）
- まだ本日分のタスクは生成されていない

### ステップ

#### 1. アプリへのアクセス
- 田中さんがブラウザで `/` （ダッシュボード）にアクセス
- ページロード時に自動で本日分タスクチェックが実行される

#### 2. 自動タスク生成
- バックグラウンドで `/api/task-instances/check-today` が呼び出される
- 2025-06-19の「日報作成」タスクが自動生成される
- （週次レポートは金曜日なので生成されない）

#### 3. タスク管理画面での確認
- 田中さんが「タスク管理」に移動
- 「デイリータスク」タブをクリック
- 本日分のタスク一覧が表示される
  ```
  ☀️ 今日のデイリータスク
  2025-06-19 (木)
  
  ⏳ 日報作成 [未完了] 高優先度
  
  完了: 0/1 タスク
  ```

#### 4. タスク完了
- 田中さんが「日報作成」タスクを完了にする
- 進捗表示が更新される
  ```
  完了: 1/1 タスク ✅
  ```

### 期待結果
- [x] ページアクセス時に必要なタスクが自動生成される
- [x] デイリータスクタブで当日分のみ表示される
- [x] 進捗が視覚的に分かりやすく表示される
- [x] 余計な手動操作が不要

---

## 📊 シナリオ 4: 管理画面での運用管理

### 前提条件
- 複数の繰り返しタスクが運用中
- 田中さんが繰り返しタスク一覧画面にいる

### ステップ

#### 1. 繰り返しタスク一覧確認
```
📋 繰り返しタスク管理

┌─────────────────────────────────┐
│ 📝 日報作成 [毎日・平日のみ]      │
│ 🔴 高優先度 | アクティブ          │
│ [編集] [無効化] [プレビュー]       │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 📊 週次レポート作成 [毎週金曜]    │
│ 🟠 中優先度 | アクティブ          │
│ [編集] [無効化] [プレビュー]       │
└─────────────────────────────────┘
```

#### 2. プレビュー機能の使用
- 「日報作成」の「プレビュー」をクリック
- 今後30日間の生成予定タスクが表示される
- 祝日や週末が正しく除外されていることを確認

#### 3. 設定変更
- 「週次レポート」の「編集」をクリック
- 締切時間を「17:00」に追加設定
- 「保存」で設定更新

#### 4. 一時的な無効化
- 夏季休暇期間中は「日報作成」を一時停止
- 「無効化」ボタンをクリック
- 今後のタスク生成が停止される

### 期待結果
- [x] 管理画面で設定の確認・変更が容易
- [x] プレビュー機能で事前確認可能
- [x] 一時的な無効化機能が動作する
- [x] 設定変更が即座に反映される

---

## 🔄 シナリオ 5: 月末・月初の複雑パターン

### 前提条件
- 毎月末に「月次レポート」作成が必要
- 月によって日数が異なる（28日、30日、31日）

### ステップ

#### 1. 月末繰り返しタスク作成
- **タスク名**: 「月次レポート作成」
- **繰り返しパターン**: 「毎月」
- **詳細設定**: 「月末」を選択
- **開始日**: 「2025-06-30」

#### 2. 複数月の動作確認
- プレビューで確認:
  ```
  📋 2025-06-30 (月) - 月次レポート作成
  📋 2025-07-31 (木) - 月次レポート作成
  📋 2025-08-31 (日) - 月次レポート作成
  📋 2025-09-30 (火) - 月次レポート作成
  ```

#### 3. 2月の特殊対応
- 2月は28日（平年）または29日（うるう年）
- システムが自動的に正しい月末日を計算

### 期待結果
- [x] 月末の自動計算が正確
- [x] うるう年の対応が正しい
- [x] 週末でも指定通りにタスク生成

---

## 📱 シナリオ 6: モバイルでの確認・完了

### 前提条件
- 田中さんが外出先でスマートフォンを使用
- デイリータスクが複数生成されている

### ステップ

#### 1. モバイルアクセス
- スマートフォンで `/tasks` にアクセス
- 「デイリータスク」タブを表示

#### 2. 今日のタスク確認
```
☀️ 今日のデイリータスク
2025-06-19 (木)

✅ 朝のメール確認 [完了]
⏳ 日報作成 [未完了]
⏳ 明日の準備 [未完了]

完了: 1/3 タスク
```

#### 3. タスク完了操作
- 「日報作成」をタップして完了状態に変更
- 即座に進捗が更新される

### 期待結果
- [x] モバイルで見やすく表示される
- [x] タッチ操作で簡単に完了できる
- [x] リアルタイムで進捗が更新される

---

## 📊 成功指標

### 機能指標
- 繰り返しタスク作成成功率: > 95%
- 自動タスク生成正確性: > 99%
- ページアクセス時チェック実行率: 100%

### ユーザビリティ指標
- 繰り返しタスク設定完了時間: < 2分
- デイリータスク確認時間: < 30秒
- UI操作エラー率: < 5%

### パフォーマンス指標
- 自動チェック処理時間: < 500ms
- 繰り返しタスク一覧表示: < 1秒
- プレビュー表示時間: < 1秒

---

## 🚨 エラー・例外シナリオ

### シナリオ 7: 重複タスク生成の防止

**状況**: 同じ日に同じ繰り返しタスクが重複生成されそうな場合

**期待動作**:
- [x] 既存タスクの存在チェック
- [x] 重複防止ロジックの実行
- [x] エラーログの出力（開発者向け）

### シナリオ 8: 不正な設定値の処理

**状況**: 存在しない日付（例：2月30日）が設定された場合

**期待動作**:
- [x] バリデーションエラーの表示
- [x] 代替日付の提案（月末など）
- [x] ユーザーフレンドリーなエラーメッセージ

---

## 🔗 関連ドキュメント

- [機能要件書 REPEAT-001](../../01-requirements/features/REPEAT-001.md)
- [受け入れ基準](../../01-requirements/acceptance-criteria.md#epic-2)
- [ユーザーストーリー](../../01-requirements/user-stories.md#epic-2)
- [詳細要件定義書](../../../要件定義書_REPEAT-001_繰り返しタスクの管理.md)

---

## 📝 備考

### 今後の検証項目
- 大量繰り返しタスクでのパフォーマンス
- タイムゾーン変更時の動作
- サーバー障害時の復旧処理

### 運用上の注意点
- データベースの定期的なクリーンアップ
- 過去データの保持期間設定
- パフォーマンス監視の実装