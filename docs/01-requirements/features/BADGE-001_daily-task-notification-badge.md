# 機能要件書 - Dailyタスク未完了バッジ表示機能

**ID**: BADGE-001  
**機能名**: Dailyタスク未完了バッジ表示機能  
**優先度**: Medium  
**作成日**: 2025-07-02  
**最終更新**: 2025-07-02  

---

## 📋 概要

### 目的
Dailyタスクの未完了件数を視覚的に分かりやすく表示し、ユーザーが即座に未完了タスクの存在を認識できるようにする。

### 背景
- 現在のシステムでは、Dailyタスクの未完了件数を確認するためにページに移動する必要がある
- ユーザーが未完了タスクを見落とすリスクがある
- UI上での視覚的な通知機能が不足している

---

## 🎯 機能要件

### 基本機能

#### 1. サイドバーバッジ表示
- [ ] **未完了件数表示**: サイドバーの「Daily」ラベルに未完了タスク数を赤丸バッジで表示
- [ ] **リアルタイム更新**: タスクの完了・追加に応じてバッジ数をリアルタイムで更新
- [ ] **ゼロ件時非表示**: 未完了タスクが0件の場合はバッジを非表示

#### 2. タブバッジ表示
- [ ] **未完了件数表示**: ブラウザタブタイトルに未完了タスク数を表示（例: "(2) Daily Tasks"）
- [ ] **リアルタイム更新**: タスクの完了・追加に応じてタブタイトルをリアルタイムで更新
- [ ] **ゼロ件時通常表示**: 未完了タスクが0件の場合は通常のタイトル表示

---

## 🔧 技術仕様

### データベース設計
既存のtasksテーブルを使用。新規テーブル作成は不要。

### API設計
既存のAPIを活用:
```
GET /api/tasks?category=daily&status=pending  # Daily未完了タスク取得
```

### コンポーネント設計
```typescript
// バッジコンポーネント
interface BadgeProps {
  count: number;
  visible?: boolean;
}

const NotificationBadge: React.FC<BadgeProps> = ({ count, visible = true }) => {
  if (!visible || count === 0) return null;
  return <span className="notification-badge">{count}</span>;
};

// Sidebarコンポーネントへの統合
const Sidebar: React.FC = () => {
  const [dailyTaskCount, setDailyTaskCount] = useState(0);
  
  // 未完了Dailyタスク数を取得
  const fetchDailyTaskCount = async () => {
    // API呼び出し実装
  };
  
  return (
    // サイドバーにバッジ表示
  );
};
```

---

## 🎨 UI/UX設計

### サイドバーバッジデザイン
```
┌─────────────────────────────────────┐
│ 📂 Dashboard                        │
│ 📋 Tasks                           │
│ 🔄 Daily ●2                       │  ← 赤丸バッジ
│ ⚙️  Settings                       │
└─────────────────────────────────────┘
```

### タブタイトルデザイン
- 未完了あり: `(2) Task Management App`
- 未完了なし: `Task Management App`

### デザインシステム
- バッジ色: #ff4444 (赤色)
- フォントサイズ: 12px
- 形状: 完全な円形
- 位置: ラベルの右側に配置

---

## ⚙️ 実装方針

### Phase 1: 基本機能実装
- [ ] 未完了Daily タスク数を取得するカスタムフック作成
- [ ] NotificationBadgeコンポーネント作成
- [ ] Sidebarコンポーネントにバッジ表示機能追加

### Phase 2: タブタイトル機能
- [ ] document.titleを動的に更新する機能実装
- [ ] useEffectでタスク数変更時の自動更新機能追加

### Phase 3: 最適化
- [ ] パフォーマンス最適化（不要な再レンダリング防止）
- [ ] エラーハンドリング追加

---

## 🧪 テスト要件

### ユニットテスト
- [ ] NotificationBadgeコンポーネントのレンダリングテスト
- [ ] カスタムフックのデータ取得テスト
- [ ] バッジ表示/非表示ロジックのテスト

### 統合テスト
- [ ] サイドバーでのバッジ表示統合テスト
- [ ] タブタイトル更新の統合テスト
- [ ] タスク完了時のリアルタイム更新テスト

### E2Eテスト
- [ ] ユーザーがタスクを完了した際のバッジ更新確認
- [ ] 新規タスク追加時のバッジ表示確認

---

## 🚨 制約・注意事項

### 技術的制約
- 既存のコンポーネント構造を大幅に変更しない
- パフォーマンスに影響を与えない軽量な実装
- ブラウザの互換性を維持

### ビジネス的制約
- Dailyタスクのみを対象とする（他のタスクタイプは除外）
- 既存のUI/UXの一貫性を保つ

### セキュリティ
- XSS攻撃を防ぐため、動的に表示する数値は適切にサニタイズ

---

## 📊 成功指標

### 機能指標
- [ ] バッジ表示レスポンス時間 < 100ms
- [ ] タスク完了からバッジ更新まで < 200ms

### ユーザビリティ指標
- [ ] ユーザーが未完了タスクの存在に気づく時間の短縮
- [ ] Daily タスクページへのアクセス率向上

---

## 🔗 関連ドキュメント

- **ユーザーストーリー**: docs/01-requirements/user-stories.md
- **受け入れ基準**: 本ドキュメント内の機能要件チェックリスト
- **API設計**: docs/02-design/api-specification.md

---

## 📝 備考

### 将来的な拡張案
- 他のタスクタイプ（Weekly、Monthly）への拡張
- バッジクリック時の直接アクション機能
- 優先度に応じたバッジ色の変更

### 参考システム
- GitHubの通知バッジ
- Slackの未読メッセージバッジ

---

**作成者**: Claude Code Assistant  
**レビュー者**: [開発者]  
**承認者**: [プロジェクトオーナー]