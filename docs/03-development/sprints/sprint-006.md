# Sprint 006: 通常タスクのポイント機能拡張

## 📋 Sprint概要

| 項目 | 内容 |
|---|---|
| Sprint ID | Sprint-006 |
| Sprint期間 | 2025年7月3日 |
| 関連Feature | POINT-002 |
| 担当者 | Claude Code Assistant |
| 優先度 | High |
| 前提条件 | POINT-001の完了 |

## 🎯 Sprint目標

現在デイリータスクのみに実装されているポイント機能を通常タスクにも拡張し、統一されたポイントシステムを構築する。通常タスクでも作成・編集・表示・完了時のポイント加算が可能になる。

## 📝 実装対象

### Sprint Backlog

| Task ID | 作業内容 | 見積時間 | ステータス | 担当者 |
|---|---|---|---|---|
| POINT-002-01 | TaskFormコンポーネントにポイント入力フィールド追加 | 45分 | 📋 計画中 | Claude |
| POINT-002-02 | バックエンドでのタスク作成・編集時ポイント保存処理 | 30分 | 📋 計画中 | Claude |
| POINT-002-03 | 通常タスク完了時のポイント加算機能 | 45分 | 📋 計画中 | Claude |
| POINT-002-04 | TaskCardでのポイント表示機能追加 | 30分 | 📋 計画中 | Claude |
| POINT-002-05 | 通常タスクでのポイント機能統合テスト | 30分 | 📋 計画中 | Claude |

**総見積時間**: 3時間

## 🏗️ 技術実装計画

### データベース変更
- **変更なし**: tasksテーブルのpointsカラムは既に存在
- **活用**: 既存のuser_pointsとpoint_historyテーブルを活用

### バックエンド変更
1. `tasksController.js` の `createTask` 関数修正
   - ポイントパラメータの受け取り・保存処理追加
2. `tasksController.js` の `updateTask` 関数修正
   - ポイント更新処理追加
   - 通常タスク完了時のポイント加算処理追加
3. POINT-001で実装済みの`addPointsForTaskCompletion`メソッドを活用

### フロントエンド変更
1. `TaskForm.tsx` の修正
   - ポイント入力フィールドの追加
   - バリデーション機能の実装
2. `TaskCard.tsx` の修正
   - ポイント表示機能の追加
   - デイリータスクと統一されたUI
3. 既存の`PointsDisplay`コンポーネントとDailyTaskContextを活用

### 型定義更新
- `TaskList.tsx` - 型定義は既に更新済み（points?: number）

## ✅ 完了定義 (Definition of Done)

### 機能要件
- [ ] 通常タスク作成時にポイントを設定できる
- [ ] 通常タスク編集時にポイントを変更できる
- [ ] TaskCardで設定されたポイントが表示される
- [ ] 通常タスク完了時にポイントが加算される
- [ ] フロントエンドでポイント表示が即座に更新される

### 技術要件
- [ ] 全てのテストが通る
- [ ] TypeScriptビルドエラーがない
- [ ] ESLintエラーがない
- [ ] デイリータスク機能に影響がない

### 品質要件
- [ ] デイリータスクと統一されたUI/UX
- [ ] 適切なエラーハンドリング
- [ ] アクセシビリティ対応
- [ ] コードレビューが完了している

## 🧪 テストシナリオ

### シナリオ1: 通常タスクの作成とポイント設定
1. 通常タスク作成フォームでポイントを設定
2. タスクが作成され、ポイントがDBに保存される
3. TaskCardでポイントが正しく表示される

### シナリオ2: 通常タスクの編集とポイント変更
1. 既存の通常タスクを編集
2. ポイント値を変更して保存
3. 変更されたポイントが正しく表示される

### シナリオ3: 通常タスク完了時のポイント加算
1. ポイントが設定された通常タスクを完了
2. ユーザーポイントに正しく加算される
3. ポイント履歴に記録される
4. フロントエンドでリアルタイム更新される

### シナリオ4: デイリータスクとの統合動作
1. デイリータスクと通常タスクを混在で完了
2. 両方のポイントが正しく加算される
3. 統一されたUI/UXで動作する

### シナリオ5: エラーケース
1. 無効なポイント値での作成・編集
2. 適切なバリデーションエラーの表示
3. ネットワークエラー時の動作

## 🚀 実装順序

### フェーズ1: フロントエンド - フォーム機能（45分）
1. TaskFormコンポーネントにポイント入力フィールド追加
2. バリデーション機能の実装
3. デイリータスクフォームとの統一性確保

### フェーズ2: バックエンド - API拡張（30分）
1. createTask関数でのポイント保存処理
2. updateTask関数でのポイント更新処理
3. バリデーション処理の追加

### フェーズ3: ポイント加算機能（45分）
1. updateTask関数に通常タスク完了時のポイント加算処理追加
2. 既存のaddPointsForTaskCompletionメソッド活用
3. エラーハンドリングの実装

### フェーズ4: フロントエンド - 表示機能（30分）
1. TaskCardでのポイント表示機能追加
2. デイリータスクと統一されたデザイン
3. 条件分岐による適切な表示

### フェーズ5: テスト・検証（30分）
1. 各機能の単体テスト
2. 統合テストの実行
3. デイリータスクとの相互動作確認

## 📊 進捗管理

### 進捗状況
- **開始**: 2025年7月3日（Sprint-005完了後）
- **現在の進捗**: 設計・計画フェーズ
- **完了予定**: 2025年7月3日

### マイルストーン
- [x] 要件定義完了
- [ ] フロントエンド（フォーム）実装完了
- [ ] バックエンドAPI拡張完了  
- [ ] ポイント加算機能実装完了
- [ ] フロントエンド（表示）実装完了
- [ ] テスト完了

## 🔗 関連ドキュメント

- [POINT-002 機能仕様書](../../01-requirements/features/POINT-002_regular-tasks-point-enhancement.md)
- [POINT-001 機能仕様書](../../01-requirements/features/POINT-001_task-completion-point-system.md)
- [Sprint-005実装結果](./sprint-005.md)

## 📝 リスク・注意事項

### 技術リスク
- デイリータスクとの統合における一貫性の確保
- 既存の通常タスク機能への影響
- ポイント加算ロジックの重複実装リスク

### 対策
- POINT-001で実装済みの機能を最大限活用
- 段階的な実装とテスト
- デイリータスクとの動作確認を徹底
- 既存機能への影響を最小限に抑える設計

### 品質リスク
- UI/UXの統一性
- パフォーマンスへの影響
- データ整合性の確保

### 対策
- デイリータスクのUIをベースにした統一設計
- 既存APIの拡張による最小限の変更
- 十分なテストによる品質確保

## 💡 実装ポイント

### 既存機能の活用
- POINT-001のポイント加算ロジックを再利用
- DailyTaskContextのrefreshTriggerを活用
- PointsDisplayコンポーネントをそのまま活用

### UI/UX統一
- デイリータスクフォームとの一貫性
- 同じポイント表示デザイン
- 統一されたバリデーションルール

### 拡張性
- 将来的なポイント機能拡張に対応した設計
- 再利用可能なコンポーネント設計
- 保守性の高いコード実装

---

**作成日**: 2025年7月3日  
**作成者**: Claude Code Assistant  
**ブランチ**: feature/all-tasks-point-system  
**前提条件**: POINT-001 (Sprint-005) の完了