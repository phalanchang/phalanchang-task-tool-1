# システム要件定義

## 1. システム概要

### 1.1 システム名
**タスク管理アプリケーション**

### 1.2 システム目的
個人のタスク管理とモチベーション向上を目的とした、ポイント制ゲーミフィケーション機能付きタスク管理システム

### 1.3 主要機能
1. **通常タスク管理**: 一般的なタスクの作成・更新・削除
2. **繰り返しタスク管理**: 毎日実行する習慣的タスクの管理
3. **ポイントシステム**: タスク完了によるポイント獲得とモチベーション向上
4. **自動スケジューラー**: 日次の繰り返しタスク自動生成

---

## 2. 機能要件

### 2.1 通常タスク管理機能

#### 2.1.1 タスク作成
- **機能**: 新しいタスクの作成
- **入力項目**:
  - タイトル（必須、255文字以内）
  - 説明（任意、テキスト）
  - 優先度（low/medium/high、デフォルト：medium）
  - ポイント数（0-1000、デフォルト：0）
- **制約条件**:
  - タイトルは必須項目
  - ポイントは0以上1000以下の整数

#### 2.1.2 タスク表示
- **機能**: 作成されたタスクの一覧表示
- **表示項目**:
  - タイトル、説明、優先度、ポイント数
  - 作成日時、更新日時
  - ステータス（保留/完了）
- **ソート機能**: 作成日時の降順

#### 2.1.3 タスク更新
- **機能**: 既存タスクの情報変更
- **更新可能項目**: タイトル、説明、優先度、ポイント数、ステータス
- **特別処理**: ステータスが保留→完了に変更された場合、自動的にポイント加算

#### 2.1.4 タスク削除
- **機能**: 不要なタスクの削除
- **制約条件**: 物理削除（復旧不可）

### 2.2 繰り返しタスク管理機能

#### 2.2.1 繰り返しタスクテンプレート作成
- **機能**: 毎日実行するタスクのテンプレート作成
- **入力項目**:
  - タイトル（必須、255文字以内）
  - 説明（任意）
  - 優先度（low/medium/high）
  - 実行時刻（HH:MM形式）
  - ポイント数（0-1000）
  - 表示順序（任意）
- **制約条件**: 実行時刻は24時間形式

#### 2.2.2 今日のタスク自動生成
- **機能**: 繰り返しタスクテンプレートから今日分のタスクインスタンス生成
- **実行タイミング**: 
  - ページアクセス時
  - 日次スケジューラー（日本時間0時）
- **重複防止**: 同一日付の同一タスクは1回のみ生成

#### 2.2.3 今日のタスク表示
- **機能**: 今日生成されたタスクインスタンスの表示
- **表示内容**: 通常タスクと同様（ソース情報付き）
- **操作**: ステータス変更、削除（インスタンスのみ）

### 2.3 ポイントシステム機能

#### 2.3.1 ポイント獲得
- **獲得条件**: タスクのステータスを保留→完了に変更
- **獲得ポイント**: 
  - 通常タスク: タスクに設定されたポイント数
  - 今日のタスク: 元の繰り返しタスクに設定されたポイント数
- **重複防止**: 同一タスクでの複数回ポイント獲得を防止

#### 2.3.2 ポイント表示
- **表示項目**:
  - 累計ポイント（全期間の合計）
  - 今日のポイント（当日獲得分）
- **表示位置**: 全画面共通ヘッダー
- **更新タイミング**: タスク完了時、日付変更時

#### 2.3.3 日次ポイントリセット
- **機能**: 日付変更時に今日のポイントを0にリセット
- **検知方法**: 
  - フロントエンド: 1分ごとの日付チェック
  - バックエンド: last_updatedとの日付比較
- **データ保持**: 履歴は point_history テーブルで永続化

### 2.4 自動スケジューラー機能

#### 2.4.1 日次タスク生成
- **実行タイミング**: 毎日日本時間0時
- **処理内容**: アクティブな繰り返しタスクから今日分を生成
- **エラーハンドリング**: 生成失敗時のログ出力

#### 2.4.2 スケジューラー監視
- **機能**: スケジューラーの動作状態確認
- **API**: GET /api/tasks/scheduler/status
- **手動実行**: POST /api/tasks/scheduler/execute

---

## 3. 非機能要件

### 3.1 性能要件
- **レスポンス時間**: 2秒以内（通常操作）
- **同時接続数**: 10ユーザー（開発環境）
- **データベース**: MySQL 8.0以上

### 3.2 可用性要件
- **稼働時間**: 開発環境のため24時間稼働不要
- **バックアップ**: 開発データのため不要

### 3.3 セキュリティ要件
- **認証**: 現在は未実装（default_userで固定）
- **データ暗号化**: 不要（個人情報なし）
- **CORS**: localhost:3000からのアクセスのみ許可

### 3.4 運用要件
- **ログ**: アプリケーションログをコンソール出力
- **監視**: Docker Composeによる基本的なヘルスチェック
- **デプロイ**: 手動デプロイ（docker-compose up）

---

## 4. システム制約

### 4.1 技術制約
- **フロントエンド**: React 18 + TypeScript
- **バックエンド**: Node.js + Express
- **データベース**: MySQL 8.0
- **コンテナ**: Docker + Docker Compose

### 4.2 業務制約
- **ユーザー数**: 1ユーザー（個人用）
- **タイムゾーン**: 日本時間（JST）固定
- **言語**: 日本語のみ

### 4.3 開発制約
- **開発環境**: WSL2 + Docker
- **ポート**: 
  - フロントエンド: 3000
  - バックエンド: 3001
  - データベース: 3306

---

## 5. データ要件

### 5.1 マスターデータ
- **繰り返しタスクテンプレート**: ユーザー定義
- **優先度**: low/medium/high（固定）
- **ステータス**: pending/completed（固定）

### 5.2 トランザクションデータ
- **通常タスク**: ユーザー作成・更新
- **今日のタスクインスタンス**: 自動生成
- **ポイント履歴**: タスク完了時自動記録

### 5.3 データ保持期間
- **タスクデータ**: 無期限
- **ポイント履歴**: 無期限（将来的に1年で削除予定）

---

## 6. インターフェース要件

### 6.1 ユーザーインターフェース
- **デザイン**: レスポンシブ対応（768px以上）
- **ブラウザ**: Chrome、Firefox、Safari（最新版）
- **アクセシビリティ**: 基本的なキーボード操作対応

### 6.2 API仕様
- **形式**: REST API
- **データ形式**: JSON
- **文字コード**: UTF-8
- **エラーレスポンス**: 統一形式

### 6.3 外部システム連携
- **現在**: なし
- **将来予定**: 
  - Slack通知
  - Google Calendar連携
  - GitHub Issues連携