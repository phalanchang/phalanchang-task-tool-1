# POINT-002: 通常タスクのポイント機能拡張

## 📋 作業概要

| ID | 作業内容 | ステータス | 優先度 | 担当者 |
|---|---|---|---|---|
| POINT-002-01 | TaskFormコンポーネントにポイント入力フィールド追加 | 📋 計画中 | High | Claude Code Assistant |
| POINT-002-02 | バックエンドでのタスク作成・編集時ポイント保存処理 | 📋 計画中 | High | Claude Code Assistant |
| POINT-002-03 | 通常タスク完了時のポイント加算機能 | 📋 計画中 | High | Claude Code Assistant |
| POINT-002-04 | TaskCardでのポイント表示機能追加 | 📋 計画中 | High | Claude Code Assistant |
| POINT-002-05 | 通常タスクでのポイント機能統合テスト | 📋 計画中 | Medium | Claude Code Assistant |

---

## 🎯 機能概要

### 目的
現在デイリータスクのみに実装されているポイント機能を、通常タスクにも拡張し、統一されたポイントシステムを構築する。

### 現在の状況
- ✅ デイリータスクにはポイント設定・表示・加算機能が実装済み
- ❌ 通常タスクではポイント機能が利用できない
- ❌ 通常タスクの作成・編集時にポイントを設定できない
- ❌ 通常タスク完了時にポイントが加算されない

### 期待される動作
1. **タスク作成時**: 通常タスク作成フォームでポイントを設定可能
2. **タスク編集時**: 既存タスクのポイントを編集可能
3. **タスク表示**: TaskCardで設定されたポイントを表示
4. **タスク完了時**: 通常タスク完了時にポイントが加算される
5. **一貫性**: デイリータスクと同じUX・UI

## 🏗️ 技術仕様

### 既存データベース構造
```sql
-- tasks テーブル（既存）
-- points カラムは既に存在している
CREATE TABLE tasks (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    status ENUM('pending', 'completed') DEFAULT 'pending',
    priority ENUM('low', 'medium', 'high') DEFAULT 'medium',
    points INT DEFAULT 0,  -- 既存のpointsカラム
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### フロントエンド実装

#### 1. TaskFormコンポーネント拡張
**ファイル**: `frontend/src/components/TaskForm.tsx`

**追加機能**:
- ポイント入力フィールドの追加
- バリデーション（0-1000の範囲）
- デイリータスクのフォームと統一されたUI

#### 2. TaskCardコンポーネント拡張
**ファイル**: `frontend/src/components/TaskCard.tsx`

**追加機能**:
- ポイント表示機能
- デイリータスクと統一されたポイント表示UI
- ポイント未設定時の適切な表示

#### 3. TaskListコンポーネント型定義更新
**ファイル**: `frontend/src/components/TaskList.tsx`

**更新内容**:
- CreateTaskData型にpoints?: numberが追加済み
- Task型にpoints?: numberが追加済み

### バックエンド実装

#### 1. タスク作成API拡張
**エンドポイント**: `POST /api/tasks`
**ファイル**: `backend/src/controllers/tasksController.js`

**更新内容**:
- リクエストボディからpointsパラメータを受け取る
- データベース保存時にpointsを含める

#### 2. タスク更新API拡張
**エンドポイント**: `PUT /api/tasks/:id`
**ファイル**: `backend/src/controllers/tasksController.js`

**更新内容**:
- ポイント値の更新処理
- タスク完了時のポイント加算処理（POINT-001の仕組みを流用）

#### 3. Task.jsモデル更新
**ファイル**: `backend/src/models/Task.js`

**更新内容**:
- createメソッドでpointsパラメータを処理
- updateメソッドでpointsパラメータを処理
- ポイント加算ロジックの通常タスク対応

## 🔧 実装タスク詳細

### POINT-002-01: TaskFormコンポーネントにポイント入力フィールド追加
**概要**: 通常タスクの作成・編集フォームにポイント設定機能を追加

**詳細**:
1. `TaskForm.tsx`にポイント入力フィールドを追加
2. デイリータスクフォームと統一されたUI実装
3. バリデーション機能（0-1000ポイント）
4. デフォルト値の設定（0ポイント）

**実装要件**:
- Material-UIのNumberInput使用
- エラーメッセージ表示
- アクセシビリティ対応

**成功条件**:
- タスク作成時にポイントを設定できる
- タスク編集時にポイントを変更できる
- 無効な値でのバリデーションエラー表示

### POINT-002-02: バックエンドでのタスク作成・編集時ポイント保存処理
**概要**: API層でのポイントデータ処理機能実装

**詳細**:
1. `tasksController.js`のcreateTask関数修正
2. `tasksController.js`のupdateTask関数修正
3. バリデーション処理の追加
4. エラーハンドリングの実装

**実装要件**:
- リクエストボディからpointsパラメータ取得
- 0-1000の範囲チェック
- NULL/undefined値の適切な処理

**成功条件**:
- タスク作成時にpointsがDBに保存される
- タスク更新時にpointsが正しく更新される
- 無効な値でのエラーレスポンス

### POINT-002-03: 通常タスク完了時のポイント加算機能
**概要**: 通常タスク完了時のポイント加算処理を実装

**詳細**:
1. `tasksController.js`のupdateTask関数にポイント加算ロジック追加
2. POINT-001で実装済みの`addPointsForTaskCompletion`メソッドを活用
3. 通常タスクでのポイント取得ロジック修正
4. ポイント履歴記録の対応

**実装要件**:
- pending → completed変更時のポイント加算
- 重複加算防止
- エラー時のタスク更新継続

**成功条件**:
- 通常タスク完了時にポイントが加算される
- ポイント履歴に記録される
- フロントエンドでリアルタイム更新

### POINT-002-04: TaskCardでのポイント表示機能追加
**概要**: 通常タスクカードにポイント表示機能を追加

**詳細**:
1. `TaskCard.tsx`にポイント表示UI追加
2. デイリータスクカードと統一されたデザイン
3. ポイント未設定時の適切な表示
4. レスポンシブ対応

**実装要件**:
- ポイント値の条件分岐表示
- アイコンとポイント数の表示
- CSSによるスタイリング

**成功条件**:
- タスクカードにポイントが表示される
- ポイント0の場合の適切な表示
- デザインの統一性

### POINT-002-05: 通常タスクでのポイント機能統合テスト
**概要**: 通常タスクのポイント機能全体のテスト実装

**詳細**:
1. タスク作成からポイント加算までの統合テスト
2. フロントエンドコンポーネントテスト
3. バックエンドAPIテスト
4. エラーケーステスト

**成功条件**:
- 全機能が正常に動作する
- エラーケースが適切に処理される
- デイリータスクと通常タスクの一貫性

## 🧪 テスト仕様

### 単体テスト
- TaskFormコンポーネントのポイント入力機能
- TaskCardコンポーネントのポイント表示機能
- バックエンドAPIのポイント処理機能
- ポイント加算ロジックのテスト

### 統合テスト
- タスク作成→編集→完了→ポイント加算の一連の流れ
- フロントエンドとバックエンドの連携
- デイリータスクと通常タスクの統合動作

### ユーザーテスト
- 通常タスク作成時のポイント設定
- 通常タスク完了時のポイント加算確認
- UIの使いやすさとデザイン統一性の確認

## 🚀 実装スケジュール

| タスク | 予想時間 | 依存関係 |
|---|---|---|
| POINT-002-01 | 45分 | なし |
| POINT-002-02 | 30分 | なし |
| POINT-002-03 | 45分 | POINT-002-02 |
| POINT-002-04 | 30分 | なし |
| POINT-002-05 | 30分 | 全タスク |

**総予想時間**: 約3時間

## 📝 技術的考慮事項

### POINT-001との統合
- 既存のポイント加算ロジックを最大限活用
- UserPointsモデルとpoint_historyテーブルの既存構造活用
- DailyTaskContextのrefreshTriggerを活用したリアルタイム更新

### UI/UX統一性
- デイリータスクと通常タスクで統一されたポイント表示
- 一貫性のあるフォーム設計
- 直感的な操作性

### データ整合性
- 既存タスクデータとの互換性確保
- ポイント未設定タスクの適切な処理
- マイグレーション不要（pointsカラム既存）

### パフォーマンス
- 既存APIの拡張による最小限の変更
- 不要なデータベースクエリの回避
- フロントエンドでの効率的な状態管理

## 🔄 既存機能への影響

### 影響なし
- 既存の通常タスク基本機能
- デイリータスク機能
- 既存のポイント表示機能

### 拡張対象
- TaskFormコンポーネント
- TaskCardコンポーネント
- tasksController.js
- 一部の型定義

## 💡 将来的な拡張可能性

### 短期的拡張
- ポイント設定のプリセット機能
- タスクカテゴリ別ポイント推奨値
- ポイント統計表示

### 長期的拡張
- ポイントベースのタスク優先度算出
- ポイント目標設定機能
- チーム環境でのポイント競争機能

---

**作成日**: 2025年7月3日  
**作成者**: Claude Code Assistant  
**ブランチ**: feature/all-tasks-point-system  
**関連Issues**: なし  
**前提条件**: POINT-001の完了